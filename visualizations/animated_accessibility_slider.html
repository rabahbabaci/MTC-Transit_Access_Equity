<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Jobs Reachable by Time of Day and Threshold (Animated)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            margin: 0;
            background: #f8f9fa;
            font-family: system-ui, sans-serif;
        }

        #plot {
            width: 100%;
            height: 720px;
        }
    </style>
</head>

<body>

    <div id="plot"></div>

    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const data = [
                // EPC tracts
                {
                    type: "bar", name: "EPC", marker: { color: "#d7191c" },
                    x: ["Oakland (EPC)", "San Leandro (EPC)", "Fremont / Union City (EPC)"],
                    y: [157287, 38124, 9125], text: ["", "", ""], textposition: "outside"
                },
                // Non-EPC tracts
                {
                    type: "bar", name: "Non-EPC", marker: { color: "#2b83ba" },
                    x: ["San Leandro (Non-EPC)", "Hayward (Non-EPC)", "San Leandro (Non-EPC)"],
                    y: [42153, 38124, 42153], text: ["", "", ""], textposition: "outside"
                }
            ];

            const layout = {
                title: { text: "Jobs Reachable by Time of Day and Threshold<br><sub>(Animated by Time Window)</sub>", font: { size: 26 } },
                xaxis: { title: "Origin Tract" },
                yaxis: { title: "Jobs Reachable", tickformat: "~s", range: [0, 290000] },
                barmode: "group",
                height: 720,
                legend: { title: { text: "Tract Type" } },
                margin: { l: 60, r: 40, t: 100, b: 60 },
                font: { size: 15 },

                updatemenus: [{
                    buttons: [
                        { args: [null, { frame: { duration: 1000, redraw: true }, fromcurrent: true, transition: { duration: 800 } }], label: "Play", method: "animate" },
                        { args: [[null], { mode: "immediate" }], label: "Pause", method: "animate" }
                    ],
                    direction: "left", pad: { r: 10, t: 87 }, showactive: false, type: "buttons",
                    x: 0.1, xanchor: "right", y: 0, yanchor: "top"
                }],

                sliders: [{
                    active: 0,
                    currentvalue: { prefix: "frame= " },
                    pad: { t: 100 },
                    steps: [
                        { label: "AM Peak — 15 min", method: "animate", args: [["AM Peak — 15 min"], { mode: "immediate" }] },
                        { label: "AM Peak — 30 min", method: "animate", args: [["AM Peak — 30 min"], { mode: "immediate" }] },
                        { label: "AM Peak — 45 min", method: "animate", args: [["AM Peak — 45 min"], { mode: "immediate" }] },
                        { label: "Late Night — 15 min", method: "animate", args: [["Late Night — 15 min"], { mode: "immediate" }] },
                        { label: "Late Night — 30 min", method: "animate", args: [["Late Night — 30 min"], { mode: "immediate" }] },
                        { label: "Late Night — 45 min", method: "animate", args: [["Late Night — 45 min"], { mode: "immediate" }] }
                    ]
                }]
            };

            const frames = [
                {
                    name: "AM Peak — 15 min", data: [
                        { y: [157287, 38124, 9125], text: ["", "", ""], textposition: "outside" },
                        { y: [42153, 38124, 42153], text: ["", "", ""], textposition: "outside" }
                    ]
                },
                {
                    name: "AM Peak — 30 min", data: [
                        { y: [198421, 62315, 48312], text: ["", "", ""], textposition: "outside" },
                        { y: [68321, 72315, 68321], text: ["", "", ""], textposition: "outside" }
                    ]
                },
                {
                    name: "AM Peak — 45 min", data: [
                        { y: [248176, 88321, 112421], text: ["", "", ""], textposition: "outside" },
                        { y: [98321, 104321, 98321], text: ["", "", ""], textposition: "outside" }
                    ]
                },
                {
                    name: "Late Night — 15 min", data: [
                        { y: [157287, 38124, 9125], text: ["0.0%", "0.0%", "0.0%"], textposition: "auto" },
                        { y: [42153, 38124, 42153], text: ["0.0%", "0.0%", "0.0%"], textposition: "auto" }
                    ]
                },
                {
                    name: "Late Night — 30 min", data: [
                        { y: [154600, 79658, 51789], text: ["−22.1%", "27.9%", "7.2%"], textposition: "auto" },
                        { y: [39821, 52642, 86215], text: ["−5.8%", "−27.3%", "26.2%"], textposition: "auto" }
                    ]
                },
                {
                    name: "Late Night — 45 min", data: [
                        { y: [179632, 55421, 156421], text: ["−27.6%", "−37.3%", "39.3%"], textposition: "auto" },
                        { y: [46000, 136000, 231000], text: ["−53.4%", "31.5%", "135.5%"], textposition: "auto" }
                    ]
                }
            ];

            Plotly.newPlot("plot", data, layout, { responsive: true })
                .then(gd => Plotly.addFrames(gd, frames));

        });
    </script>
</body>

</html>